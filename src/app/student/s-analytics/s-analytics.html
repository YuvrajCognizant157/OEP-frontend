<div class="analytics-container">
    <h1 class="page-title">Student Analytics</h1>

    <div class="analytics-grid">
        <!-- Bar Chart -->
        <mat-card class="chart-card">
            <mat-card-header>
                <mat-card-title>Performance througout Attempts</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <div class="no-records-container" *ngIf="!hasBarData">
                    <img src="assets/GIFs/bar-chart.gif" alt="No Bar Chart Data" class="no-data-gif" />
                    <p>No attempt scores recorded yet!</p>
                    <p>Complete your first exam to see your performance history.</p>
                </div>
                <div *ngIf="hasBarData">
                    <canvas baseChart [data]="barChartData" [options]="barChartOptions" [type]="barChartType">
                    </canvas>
                </div>
            </mat-card-content>
        </mat-card>

        <!-- Pie Chart -->
        <mat-card class="chart-card">
            <mat-card-header>
                <mat-card-title>Performance By topics</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <div class="no-records-container" *ngIf="!hasPieData">
                    <img src="assets/GIFs/pie-chart.gif" alt="No Pie Chart Data" class="no-data-gif" />
                    <p>Topic performance data not available!</p>
                    <p>Take exams covering various topics to get a breakdown of your strengths.</p>
                </div>
                <div *ngIf="hasPieData">
                    <canvas baseChart [data]="pieChartData" [options]="pieChartOptions" [type]="pieChartType">
                    </canvas>
                </div>
            </mat-card-content>
        </mat-card>

        <mat-card class="chart-card">
            <mat-card-header>
                <mat-card-title>Attempts Count Records</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <div class="no-records-container" *ngIf="!hasDoughnutData">
                    <img src="assets/GIFs/pie-chart.gif" alt="No Doughnut Chart Data" class="no-data-gif" />
                    <p>No attempts history to show!</p>
                    <p>This chart will show your single, double, and triple attempt breakdown.</p>
                </div>
                <div *ngIf="hasDoughnutData">
                    <canvas baseChart [data]="doughnutChartData" [options]="doughnutChartOptions"
                        [type]="doughnutChartType">
                    </canvas>
                </div>
            </mat-card-content>
        </mat-card>

        <mat-card class="chart-card full-width">
            <mat-card-header>
                <mat-card-title>Topic-Wise Effort</mat-card-title>
                <mat-card-subtitle>Total Questions Attempted by Topic</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
                <ng-container *ngIf="hasTopicLineData; else noTopicData">
                    <div style="display: block;">
                        <canvas baseChart [data]="topicLineChartData" [options]="topicLineChartOptions"
                            [type]="topicLineChartType">
                        </canvas>
                    </div>
                </ng-container>

                <ng-template #noTopicData>
                    <p class="no-data-message">No topic-wise question attempt data available.</p>
                </ng-template>
            </mat-card-content>
        </mat-card>

        <!-- Line Chart -->
        <mat-card class="chart-card full-width">
            <mat-card-header class="chart-header-controls">
                <mat-card-title>Score Progression by Exam</mat-card-title>

                <div class="exam-select-container" *ngIf="availableExams.length > 0">
                    <label for="exam-selector">Select Exam:</label>
                    <select id="exam-selector" [(ngModel)]="selectedExamId" (ngModelChange)="loadLineChartData($event)">

                        <option *ngFor="let exam of availableExams" [ngValue]="exam.eid">
                            {{ exam.examName }}
                        </option>
                    </select>
                </div>
            </mat-card-header>

            <mat-card-content>
                <div *ngIf="isLoadingResults" class="chart-loading-overlay">
                    <mat-spinner diameter="50"></mat-spinner>
                </div>

                <div *ngIf="!isLoadingResults && availableExams.length === 0" class="no-records-container">
                    <img src="assets/GIFs/bar-chart.gif" alt="No Line Chart Data" class="no-data-gif" />
                    <p>No completed exam results available to track progression.</p>
                    <p>Complete at least one exam to view your score trends here.</p>
                </div>

                <div *ngIf="!isLoadingResults && availableExams.length > 0" class="chart-container">
                    <canvas baseChart [data]="lineChartData" [options]="lineChartOptions" [type]="lineChartType">
                    </canvas>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
</div>