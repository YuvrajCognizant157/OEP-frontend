<div class="dashboard-container dark-theme">

    <mat-card class="header-card">
        <div class="header-content">
            <div class="header-text">
                <h2>Welcome back, {{ student.name }} ðŸ‘‹</h2>
                <p class="subtitle">Youâ€™ve appeared in {{ examsAppearedTotal() }} exams so far.</p>
            </div>
            <button mat-flat-button color="primary" routerLink="/view-profile" routerLinkActive="active">View
                Profile</button>
        </div>
    </mat-card>

    <div class="main-content-grid">

        <!-- Quick Actions in 3 separate cards (single column layout) -->
        <div class="actions-column">
            <mat-card class="action-card" routerLink="/student/analytics">
                <div class="action-card-content">
                    <div class="card-info">
                        <mat-icon color="primary">insights</mat-icon>
                        <div class="card-text">
                            <h4>Analytics Insights</h4>
                            <p class="tagline">View detailed reports on your performance.</p>
                        </div>
                    </div>
                    <button mat-icon-button color="primary">
                        <mat-icon>arrow_forward</mat-icon>
                    </button>
                </div>
            </mat-card>

            <mat-card class="action-card" routerLink="/student/results">
                <div class="action-card-content">
                    <div class="card-info">
                        <mat-icon color="accent">leaderboard</mat-icon>
                        <div class="card-text">
                            <h4>View Results</h4>
                            <p class="tagline">Check scores and detailed analysis.</p>
                        </div>
                    </div>
                    <button mat-icon-button color="accent">
                        <mat-icon>arrow_forward</mat-icon>
                    </button>
                </div>
            </mat-card>

            <mat-card class="action-card" routerLink="student/feedback">
                <div class="action-card-content">
                    <div class="card-info">
                        <mat-icon color="accent">rate_review</mat-icon>
                        <div class="card-text">
                            <h4>Feedback</h4>
                            <p class="tagline">Share your experience with us.</p>
                        </div>
                    </div>
                    <button mat-icon-button color="accent">
                        <mat-icon>arrow_forward</mat-icon>
                    </button>
                </div>
            </mat-card>
        </div>

        <!-- Right column: total questions with animation -->
        <div class="questions-summary-row" style="display: flex; gap: 16px;">
            <mat-card class="questions-summary-card" style="flex: 1;">
                <h3>Questions Encountered</h3>
                <div class="circle-progress" style="position: relative; display: inline-block;">
                    <!-- Outer outline -->
                    <div style="
                    position: absolute;
                    top: 0; left: 0; 
                    width: 100px; height: 100px;
                    border-radius: 50%;
                    border: 3px solid #bdbdbd;
                    box-sizing: border-box;
                    z-index: 1;
                ">
                    </div>
                    <!-- Spinner -->
                    <mat-progress-spinner [value]="percentageAnalytics().questionsEncounteredPercent" mode="determinate"
                        diameter="100" color="primary" style="position: relative; z-index: 2;">
                    </mat-progress-spinner>
                    <!-- Inner outline -->
                    <div style="
                    position: absolute;
                    top: 15px; left: 15px; 
                    width: 70px; height: 70px;
                    border-radius: 50%;
                    border: 2px solid #e0e0e0;
                    box-sizing: border-box;
                    z-index: 3;
                ">
                    </div>
                    <div class="percentage-text"
                        style="position: absolute; top: 35px; left: 0; width: 100px; text-align: center; z-index: 4;">
                        {{ percentageAnalytics().questionsEncounteredPercent }}%
                    </div>
                </div>
            </mat-card>
            <mat-card class="questions-summary-card" style="flex: 1;">
                <h3>Exams Attempted</h3>
                <div class="circle-progress" style="position: relative; display: inline-block;">
                    <!-- Outer outline -->
                    <div style="
                    position: absolute;
                    top: 0; left: 0; 
                    width: 100px; height: 100px;
                    border-radius: 50%;
                    border: 3px solid #bdbdbd;
                    box-sizing: border-box;
                    z-index: 1;
                ">
                    </div>
                    <!-- Spinner -->
                    <mat-progress-spinner [value]="percentageAnalytics().examsAttemptedPercent" mode="determinate"
                        diameter="100" color="accent" style="position: relative; z-index: 2;">
                    </mat-progress-spinner>
                    <!-- Inner outline -->
                    <div style="
                    position: absolute;
                    top: 15px; left: 15px; 
                    width: 70px; height: 70px;
                    border-radius: 50%;
                    border: 2px solid #e0e0e0;
                    box-sizing: border-box;
                    z-index: 3;
                ">
                    </div>
                    <div class="percentage-text"
                        style="position: absolute; top: 35px; left: 0; width: 100px; text-align: center; z-index: 4;">
                        {{ percentageAnalytics().examsAttemptedPercent }}%
                    </div>
                </div>
            </mat-card>
        </div>



        <mat-card class="available-exams-card">
            <h3>Available Exams</h3><br />
            <div class="exam-list">
                <div *ngFor="let exam of availableExamsList | slice:0:2" class="exam-item">
                    <div class="exam-details">
                        <h4>{{ exam.examName }}</h4>
                        <p>Duration: {{ exam.duration }} mins | Marks: {{ exam.totalMarks }}</p>
                    </div>
                    <button mat-flat-button color="primary" (click)="startExam(exam.eid)">Start Exam</button>
                </div>
            </div>
            <button mat-button class="view-all-btn" [routerLink]="['/student/available-exams']">View All Exams</button>
        </mat-card>


        <mat-card class="analytics-card">
            <h3>Exam Attempts Distribution</h3><br />

            <div class="no-records-container" *ngIf="!hasAttemptsData">
                <img src="assets/GIFs/pie-chart.gif" alt="No Attempts Data" class="no-data-gif" />
                <p>No results found for attempts distribution.</p>
                <p>Complete a few exams to see the breakdown!</p>
            </div>

            <div *ngIf="hasAttemptsData">
                <canvas baseChart [data]="attemptsChartData" [options]="attemptsChartOptions" type="pie">
                </canvas>
            </div>
        </mat-card>

        <mat-card class="topic-exams-graph-card">
            <h3>Exams Appeared by Topic</h3><br />

            <div class="no-records-container" *ngIf="!hasTopicData">
                <img src="assets/GIFs/bar-chart.gif" alt="No Topic Data" class="no-data-gif" />
                <p>No topic scores available yet.</p>
                <p>Your scores across different subjects will appear here.</p>
            </div>

            <div *ngIf="hasTopicData">
                <canvas baseChart [data]="topicExamsChartData" [options]="topicExamsChartOptions" chartType="bar">
                </canvas>
            </div>
        </mat-card>

        <mat-card class="history-card">
            <h3>Exam History</h3><br />

            <div class="no-records-container" *ngIf="!examResultsHistory || examResultsHistory.length === 0">
                <img src="assets/GIFs/no-data.gif" alt="No Records Found" class="no-data-gif" />
                <p>No exams have been attempted yet.</p>
                <p>Start an exam to see your history!</p>
            </div>

            <div class="history-list" *ngIf="examResultsHistory && examResultsHistory.length > 0">
                <div class="history-item" *ngFor="let exam of examResultsHistory | slice:0:3">

                    <ng-container *ngIf="exam.attemptsData && exam.attemptsData.length > 0">
                        <ng-container *ngFor="let attempt of exam.attemptsData | slice:-1">
                            <div class="history-title-score">
                                <span class="exam-title">
                                    {{ exam.examName }}
                                    (Attempt {{ attempt.attempt }})
                                </span>
                                <span class="exam-score">{{ attempt.score }}/{{ exam.totalMarks }}</span>
                            </div>
                            <span class="exam-date">{{ attempt.takenOn | date: 'mediumDate' }}</span>
                        </ng-container>
                    </ng-container>

                    <div *ngIf="!exam.attemptsData || exam.attemptsData.length === 0">
                        <span class="exam-title">{{ exam.examName }}</span>
                        <span class="exam-date">No attempts recorded.</span>
                    </div>

                </div>
            </div>

            <button mat-button class="view-all-btn" routerLink="/student/results"
                *ngIf="examResultsHistory && examResultsHistory.length > 0">
                Full History
            </button>
        </mat-card>

    </div>
</div>