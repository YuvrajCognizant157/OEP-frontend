<div class="form-container">
  <h1>Create a New Exam</h1>

  <form [formGroup]="examForm" (ngSubmit)="addQuestions()" class="exam-form">

    <mat-form-field appearance="fill" class="grid-col-span-2">
      <mat-label>Exam Name**</mat-label>
      <input matInput formControlName="name" />
      @if (examForm.get('name')?.hasError('required') && (examForm.get('name')?.touched || examForm.get('name')?.dirty)) {
        <mat-error>Exam name is required.</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="fill" class="grid-col-span-2">
      <mat-label>Description</mat-label>
      <textarea matInput formControlName="description"></textarea>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Duration (in minutes)**</mat-label>
      <input matInput type="number" formControlName="duration" />
      @if (examForm.get('duration')?.invalid && (examForm.get('duration')?.touched || examForm.get('duration')?.dirty)) {
        <mat-error>A valid, positive duration is required.</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Total Questions**</mat-label>
      <input matInput type="number" formControlName="totalQuestions" />
       @if (examForm.get('totalQuestions')?.invalid && (examForm.get('totalQuestions')?.touched || examForm.get('totalQuestions')?.dirty)) {
        <mat-error>Total questions must be at least 1.</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Displayed Questions (min 1)**</mat-label>
      <input matInput type="number" formControlName="displayedQuestions" />
      @if (examForm.get('displayedQuestions')?.invalid && (examForm.get('displayedQuestions')?.touched || examForm.get('displayedQuestions')?.dirty)) {
        <mat-error>displayedQuestions must be at least 1.</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Marks Per Question**</mat-label>
      <input matInput type="number" formControlName="marksPerQuestion" />
      @if (examForm.get('marksPerQuestion')?.invalid && (examForm.get('marksPerQuestion')?.touched || examForm.get('marksPerQuestion')?.dirty)) {
        <mat-error>Marks must be at least 1.</mat-error>
      }
    </mat-form-field>

    <div class="topics-container grid-col-span-2">
      <h3>Select Topics**</h3>
      <div class="topics-checkbox-group">
        @if (topicsAsync$ | async; as resolvedTopics) {
          
          @for (topic of resolvedTopics; track topic.tid) {
            <mat-checkbox class="topic-checkbox" (change)="onTopicChange($event, topic.tid)">
              {{ topic.subject }}
            </mat-checkbox>
          }

          @if (resolvedTopics.length === 0) {
            <p>No topics available.</p>
          }

        } @else {
          <p>Loading topics...</p>
        }
      </div>
    </div>
    
    <div class="actions-container grid-col-span-2">
       <button mat-raised-button color="primary" type="submit">
        Add Exam
       </button>
    </div>

  </form>
</div>